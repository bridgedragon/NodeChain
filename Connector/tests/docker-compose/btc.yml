version: "3"
services:
  bitcoincore:
    build: ../../../packages/nodechain-bitcoin-core
    image: bitcoincore
    command: -rpcuser=swapper
      -rpcpassword=swapper
      -server=1
      -rpcallowip=0.0.0.0/0
      -rpcbind=0.0.0.0
      -txindex=1
      -regtest=1
      -debug=1
      -rpcport=8332
      -deprecatedrpc=generate
      -fallbackfee=0.0001
      -zmqpubhashblock=tcp://0.0.0.0:28332
    volumes:
      - ${BLOCKCHAIN_PATH}/bitcoincode:/home/bitcoin/.bitcoin
    ports:
      - 8332:8332
      - 28332:28332

  electrumx:
    image: lukechilds/electrumx
    environment:
      DAEMON_URL: http://swapper:swapper@bitcoincore:8332
      COIN: BitcoinSegwit
      PEER_DISCOVERY: "off"
      SERVICES: tcp://:50001
      COST_SOFT_LIMIT: 0 #Disable cost limitation so electrumx does not crash electrum during sync
      COST_HARD_LIMIT: 0
      NET: regtest
    volumes:
      - ${BLOCKCHAIN_PATH}/electrumx:/data

  electrum:
    build: ../../../packages/nodechain-electrum-regtest
    image: electrum
    environment:
      TESTNET: 1
    ports:
      - 30000:30000
